<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <title>BOMA teaser autunno inverno</title>
  <style>
    :root{--bg1:#0f1c2e;--bg2:#09121f;--ink:#eef6ff;--stroke:rgba(255,255,255,.14);}
    html,body{height:100%;margin:0}
    body{
      background:radial-gradient(120% 120% at 50% 0%, var(--bg1) 0%, var(--bg2) 100%);
      color:var(--ink);font-family:Inter,system-ui,Arial;
      overflow:hidden;-webkit-tap-highlight-color:transparent
    }

    header{position:absolute;top:0;left:0;right:0;z-index:5;
      display:flex;justify-content:center;padding:12px}
    .title{font-weight:900;font-size:18px;text-align:center}

    /* Frase centrale */
    .line{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      font-weight:900;font-size:7vw;text-align:center;line-height:1.2;max-width:90%;
      text-shadow:0 8px 24px rgba(0,0,0,.35)
    }

    .scene{position:absolute;inset:0;overflow:hidden}

    /* CTA */
    .cta{position:absolute;left:50%;bottom:20px;transform:translateX(-50%);z-index:5}
    .cta button{border:none;background:#8ad6ff;color:#041327;
      font-weight:900;padding:12px 18px;border-radius:12px;font-size:15px}

    /* Modale */
    #wlModal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;z-index:50}
    #wlModal .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55)}
    #wlModal .box{width:100%;max-width:460px;background:rgba(8,17,30,.96);
      border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid var(--stroke);
      padding:16px;backdrop-filter:blur(8px);position:relative;z-index:2}
    #wlModal input[type=email]{width:100%;padding:12px;border-radius:12px;
      border:1px solid var(--stroke);background:rgba(255,255,255,.05);color:var(--ink);font-size:15px;margin-bottom:8px}
    #wlModal label{font-size:12px;display:flex;gap:6px;align-items:flex-start;margin-bottom:8px}
    #wlModal button[type=submit]{width:100%;padding:12px;border-radius:12px;border:none;font-weight:900;font-size:15px;
      background:linear-gradient(90deg,#bfe8ff,#8ad6ff);color:#041327}

    /* Animazioni */
    .leaf{position:absolute;top:-10vh;will-change:transform,opacity;animation:fallY 14s linear forwards}
    .leaf .rot{display:inline-block;animation:spin 12s linear forwards}
    .flake{position:absolute;top:-10vh;will-change:transform,opacity;font-size:18px;color:#eaf6ff;text-shadow:0 0 10px rgba(200,235,255,.45);animation:fallY 16s linear forwards}
    @keyframes fallY{0%{transform:translate(var(--x,0vw),-10vh)}100%{transform:translate(calc(var(--x,0vw) + var(--drift,0px)),110vh)}}
    @keyframes spin{0%{transform:rotate(var(--r,0deg))}100%{transform:rotate(var(--rEnd,180deg))}}
  </style>
</head>
<body>
  <header><div class="title">BOMA teaser autunno inverno</div></header>

  <!-- Frase centrale -->
  <div id="line" class="line">Sei pronto? Novità in arrivo per la nuova stagione</div>

  <div class="scene" id="scene" aria-hidden="true"></div>

  <div class="cta"><button id="ctaOpen">Entra in lista</button></div>

  <!-- Modale -->
  <div id="wlModal">
    <div class="backdrop" id="wlBackdrop"></div>
    <div class="box">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Lista d’attesa</strong>
        <button id="wlClose" style="background:none;border:none;color:var(--ink)">✕</button>
      </div>
      <form id="waitlist">
        <input id="email" name="email" type="email" placeholder="La tua email" required>
        <label><input id="consent" type="checkbox" required> Acconsento a ricevere aggiornamenti sul Boma</label>
        <button type="submit">Iscrivimi</button>
        <div style="font-size:11px;opacity:.7;margin-top:6px">
          Titolare: Nome Locale S.r.l.  Uso: gestione lista e invio info. Puoi revocare in ogni momento.
        </div>
      </form>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const scene = document.getElementById('scene')
  const lineEl = document.getElementById('line')

  // Frasi su slot da 5 minuti
  const FRASES = [
    'Sei pronto? Novità in arrivo per la nuova stagione',
    'Pronti a cambiare ritmo',
    'Scalda l’attesa. Il Boma si avvicina',
    'Ultimi colori d’autunno. L’inverno chiama',
    'Gelo in arrivo. Preparati',
    'La notte si accende. Nuovo capitolo',
    'Quasi pronti a svelare tutto',
    'È il momento. Ci vediamo presto',
    'Il conto alla rovescia continua',
    'Manca pochissimo',
    'Tieniti pronto, ci siamo quasi',
    'Scopri la magia della nuova stagione'
  ]

  function modeForHour(h){ return (h>=20 && h<=23) ? 'winter' : 'autumn' }

  const PALETTES = [
    ['#ffb703','#fb8500','#e76f51','#ffd166'], // autunno
    ['#c2f5ff','#8ad6ff','#bfe8ff','#eaf6ff']  // inverno
  ]
  const SHAPES = [
    'M50 0 C40 18 30 24 18 30 C30 34 36 38 32 50 C44 46 50 44 50 44 C50 44 56 46 68 50 C64 38 70 34 82 30 C70 24 60 18 50 0 Z',
    'M50 4 C18 6 6 34 10 56 C14 74 30 90 50 96 C70 90 86 74 90 56 C94 34 82 6 50 4 Z'
  ]

  // Aggiorna tema e frase ogni 5 minuti
  function updateTheme(){
    const now = new Date()
    const h = now.getHours()
    const slot = Math.floor(now.getMinutes() / 5) // 0..11
    document.body.dataset.mode = modeForHour(h)
    lineEl.textContent = FRASES[slot]

    // micro variazioni visive per slot
    currentTargetLeaves = 34 + slot   // 34..45
    currentMaxFlakes = 10 + Math.floor(slot/2) // 10..15
  }

  // Generatori
  function createLeaf(){
    const leaf = document.createElement('div'); leaf.className = 'leaf'
    const palette = (document.body.dataset.mode==='winter') ? PALETTES[1] : PALETTES[0]
    const c1 = palette[Math.floor(Math.random()*palette.length)]
    const c2 = palette[Math.floor(Math.random()*palette.length)]
    const shape = SHAPES[Math.floor(Math.random()*SHAPES.length)]
    const size = Math.random()*20 + 20
    const startX = Math.random()*100
    const driftPx = Math.floor(Math.random()*120 - 60)
    const dur = 6 + Math.random()*8
    const baseDeg = Math.floor(Math.random()*180)
    const spinDeg = Math.random()>0.5 ? 180 : -180
    leaf.style.setProperty('--x', startX+'vw')
    leaf.style.setProperty('--drift', driftPx+'px')
    leaf.style.setProperty('--r', baseDeg+'deg')
    leaf.style.setProperty('--rEnd', (baseDeg+spinDeg)+'deg')
    leaf.style.animationDuration = `${dur}s`
    const gid = 'g'+Math.random().toString(36).slice(2)
    const rot = document.createElement('div')
    rot.className = 'rot'; rot.style.animationDuration = `${dur*0.9}s`
    rot.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="${gid}" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="${c1}" /><stop offset="100%" stop-color="${c2}" /></linearGradient></defs><path d="${shape}" fill="url(#${gid})" /></svg>`
    leaf.appendChild(rot)
    leaf.addEventListener('animationend', ()=> leaf.remove())
    return leaf
  }

  function createFlake(){
    const el = document.createElement('div'); el.className = 'flake'; el.textContent = '❄'
    const startX = Math.random()*100
    const driftPx = Math.floor(Math.random()*80 - 40)
    const dur = 8 + Math.random()*10
    el.style.setProperty('--x', startX+'vw')
    el.style.setProperty('--drift', driftPx+'px')
    el.style.animationDuration = dur+'s'
    el.addEventListener('animationend', ()=> el.remove())
    return el
  }

  // Loop animazione con target dinamici
  let currentTargetLeaves = 40
  let currentMaxFlakes = 14
  function loop(){
    if(scene.querySelectorAll('.leaf').length < currentTargetLeaves) scene.appendChild(createLeaf())
    if(document.body.dataset.mode==='winter' && scene.querySelectorAll('.flake').length < currentMaxFlakes) scene.appendChild(createFlake())
    requestAnimationFrame(loop)
  }

  // Avvio e timer
  updateTheme()
  loop()
  // ricontrollo frequente così il cambio scatta subito quando entri in una nuova finestra da 5 minuti
  setInterval(updateTheme, 15000)

  // Waitlist semplice con Formspree
  const modal = document.getElementById('wlModal')
  document.getElementById('ctaOpen').onclick = () => modal.style.display='flex'
  document.getElementById('wlClose').onclick = () => modal.style.display='none'
  document.getElementById('wlBackdrop').onclick = () => modal.style.display='none'

  document.getElementById('waitlist').addEventListener('submit', async e=>{
    e.preventDefault()
    const email = document.getElementById('email').value.trim()
    const consent = document.getElementById('consent').checked
    if(!email || !consent){ alert('Inserisci email e consenso'); return }
    const data = new FormData()
    data.append('email', email)
    data.append('consent', consent ? 'yes' : 'no')
    try{
      const res = await fetch('https://formspree.io/f/xxxxxxx', { // sostituisci con il tuo endpoint
        method:'POST', headers:{'Accept':'application/json'}, body:data
      })
      if(!res.ok) throw new Error('server')
      alert('Iscrizione confermata'); e.target.reset(); modal.style.display='none'
    }catch(err){ alert('Errore invio. Riprova') }
  })
})
</script>
</body>
</html>
