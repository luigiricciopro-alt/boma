<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <title>BOMA teaser</title>
  <style>
    :root{
      --bg1:#0f1c2e;
      --bg2:#09121f;
      --ink:#eef6ff;
      --stroke:rgba(255,255,255,.14);
    }
    html,body{height:100%;margin:0}
    body{
      background:radial-gradient(120% 120% at 50% 0%, var(--bg1) 0%, var(--bg2) 100%);
      color:var(--ink);font-family:Inter,system-ui,Arial;
      overflow:hidden;-webkit-tap-highlight-color:transparent
    }

    header{
      position:absolute;top:0;left:0;right:0;z-index:5;
      display:flex;justify-content:center;padding:12px
    }
    .title{font-weight:900;font-size:18px;text-align:center}

    /* Frase centrale */
    .line{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      font-weight:900;font-size:7vw;text-align:center;line-height:1.2;max-width:90%;
      text-shadow:0 8px 24px rgba(0,0,0,.35);transition:opacity .5s
    }
    .line.fade{opacity:.15}

    .scene{position:absolute;inset:0;overflow:hidden}

    /* CTA */
    .cta{position:absolute;left:50%;bottom:20px;transform:translateX(-50%);z-index:5}
    .cta button{border:none;background:#8ad6ff;color:#041327;
      font-weight:900;padding:12px 18px;border-radius:12px;font-size:15px}

    /* Modale */
    #wlModal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;z-index:50}
    #wlModal .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55)}
    #wlModal .box{width:100%;max-width:460px;background:rgba(8,17,30,.96);
      border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid var(--stroke);
      padding:16px;backdrop-filter:blur(8px);position:relative;z-index:2}
    #wlModal input[type=email]{width:100%;padding:12px;border-radius:12px;
      border:1px solid var(--stroke);background:rgba(255,255,255,.05);color:var(--ink);font-size:15px;margin-bottom:8px}
    #wlModal label{font-size:12px;display:flex;gap:6px;align-items:flex-start;margin-bottom:8px}
    #wlModal button[type=submit]{width:100%;padding:12px;border-radius:12px;border:none;font-weight:900;font-size:15px;
      background:linear-gradient(90deg,#bfe8ff,#8ad6ff);color:#041327}

    /* Particelle */
    .leaf{position:absolute;top:-10vh;will-change:transform,opacity;animation:fallY 12s linear forwards}
    .leaf .rot{display:inline-block;animation:spin 10s linear forwards}
    .flake{position:absolute;top:-10vh;will-change:transform,opacity;animation:fallY 14s linear forwards}
    .flakeTxt{position:absolute;top:-10vh;will-change:transform,opacity;font-size:18px;animation:fallY 14s linear forwards}

    @keyframes fallY{
      0%{transform:translate(var(--x,0vw),-10vh)}
      100%{transform:translate(calc(var(--x,0vw) + var(--drift,0px)),110vh)}
    }
    @keyframes spin{
      0%{transform:rotate(var(--r,0deg))}
      100%{transform:rotate(var(--rEnd,210deg))}
    }
  </style>
</head>
<body>
  <header><div class="title">BOMA teaser</div></header>

  <div id="line" class="line">Sei pronto? Novità in arrivo per la nuova stagione</div>

  <div class="scene" id="scene" aria-hidden="true"></div>

  <div class="cta"><button id="ctaOpen">Entra in lista</button></div>

  <!-- Modale -->
  <div id="wlModal">
    <div class="backdrop" id="wlBackdrop"></div>
    <div class="box">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Lista d’attesa</strong>
        <button id="wlClose" style="background:none;border:none;color:var(--ink)">✕</button>
      </div>
      <form id="waitlist">
        <input id="email" name="email" type="email" placeholder="La tua email" required>
        <label><input id="consent" type="checkbox" required> Acconsento a ricevere aggiornamenti sul Boma</label>
        <button type="submit">Iscrivimi</button>
        <div style="font-size:11px;opacity:.7;margin-top:6px">
          Titolare: Nome Locale S.r.l.  Uso: gestione lista e invio info. Puoi revocare in ogni momento.
        </div>
      </form>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const scene = document.getElementById('scene')
  const lineEl = document.getElementById('line')

  // 12 temi. Ogni slot dura 5 minuti. Alternanza dentro l’asse Autunno Inverno.
  const THEMES = [
    { // 0 4
      name:'Foglie dorate',
      mode:'autumn',
      bg:['#1a2537','#0c1524'],
      palette:['#ffb703','#fb8500','#e76f51','#ffd166'],
      shapes:'leaves',
      text:'Sei pronto? Novità in arrivo per la nuova stagione'
    },
    { // 5 9
      name:'Brina mattutina',
      mode:'winter',
      bg:['#0b1930','#0a1022'],
      palette:['#c2f5ff','#8ad6ff','#bfe8ff','#eaf6ff'],
      shapes:'flakes',
      text:'Respiro d’inverno. Sorprese all’orizzonte'
    },
    { // 10 14
      name:'Rame e castagne',
      mode:'autumn',
      bg:['#261c1a','#0f1216'],
      palette:['#d97706','#f59e0b','#b45309','#92400e'],
      shapes:'leavesHeavy',
      text:'Profumo di bosco. Pronto al cambio'
    },
    { // 15 19
      name:'Cristalli polari',
      mode:'winter',
      bg:['#0a1724','#0a0f19'],
      palette:['#bbf0ff','#a5e3ff','#daefff','#9bd1ff'],
      shapes:'crystals',
      text:'Gelo creativo. Il Boma si avvicina'
    },
    { // 20 24
      name:'Vento d’autunno',
      mode:'autumn',
      bg:['#1a2431','#0c121b'],
      palette:['#ffbe76','#ffa502','#ff7f50','#ff6b6b'],
      shapes:'leavesLite',
      text:'Ultimi colori. Nuova stagione in arrivo'
    },
    { // 25 29
      name:'Neve soffice',
      mode:'winter',
      bg:['#0b1a2c','#091223'],
      palette:['#eaf6ff','#dff2ff','#cfe9ff','#bfe0ff'],
      shapes:'flakesSoft',
      text:'Nevica piano. Preparati al lancio'
    },
    { // 30 34
      name:'Bacche rosse',
      mode:'autumn',
      bg:['#20151a','#0f1016'],
      palette:['#f94144','#f3722c','#f8961e','#f9844a'],
      shapes:'berries',
      text:'Dettagli che scaldano. Siamo quasi pronti'
    },
    { // 35 39
      name:'Aghi di pino',
      mode:'winter',
      bg:['#0a1c28','#08111b'],
      palette:['#bde0fe','#a2d2ff','#caf0f8','#ade8f4'],
      shapes:'needles',
      text:'Aria frizzante. Nuovo capitolo in vista'
    },
    { // 40 44
      name:'Tramonto rame',
      mode:'autumn',
      bg:['#291a14','#111016'],
      palette:['#ffadad','#ffd6a5','#fdc086','#f4a261'],
      shapes:'leavesRound',
      text:'Ritmo che cambia. Tieniti pronto'
    },
    { // 45 49
      name:'Notte artica',
      mode:'winter',
      bg:['#0b1324','#070e19'],
      palette:['#b8e1ff','#9bd1ff','#c9f1ff','#ffffff'],
      shapes:'stars',
      text:'Cielo terso. Magia in arrivo'
    },
    { // 50 54
      name:'Raccolto',
      mode:'autumn',
      bg:['#201c13','#0f1013'],
      palette:['#c9a227','#dda15e','#bc6c25','#e76f51'],
      shapes:'acorns',
      text:'Calore e attesa. Il momento si avvicina'
    },
    { // 55 59
      name:'Ghiaccio vivo',
      mode:'winter',
      bg:['#0a1526','#07101b'],
      palette:['#94d2ff','#7ac8ff','#b3e5ff','#e0f2ff'],
      shapes:'shards',
      text:'Scintille di ghiaccio. Ci vediamo presto'
    }
  ]

  // Utility
  const LEAF_SHAPES = [
    'M50 0 C40 18 30 24 18 30 C30 34 36 38 32 50 C44 46 50 44 50 44 C56 46 68 50 64 38 70 34 82 30 70 24 60 18 50 0 Z',
    'M50 4 C18 6 6 34 10 56 C14 74 30 90 50 96 C70 90 86 74 90 56 C94 34 82 6 50 4 Z',
    'M50 6 C36 14 28 24 26 36 C18 40 14 50 18 60 C12 68 18 80 28 84 C34 96 44 100 50 100 C56 100 66 96 72 84 C82 80 88 68 82 60 C86 50 82 40 74 36 C72 24 64 14 50 6 Z',
    'M50 8 C30 10 16 20 12 34 C22 46 36 52 50 52 C64 52 78 46 88 34 C84 20 70 10 50 8 Z'
  ]
  const EMOJI = {
    flakes:['❄','✻','✼','✽'],
    softFlakes:['❄','•','·','✶'],
    berries:['●','•','◍'],
    stars:['✦','✧','✩','✫','✯'],
    needles:['|','∣','⎟'],
    acorns:['⬤','◐','◑'],
    shards:['▴','▵','▾','▿','◢','◣']
  }

  let currentSlot = -1
  let targetLeaves = 40
  let targetFlakes = 0

  function setBackground(c1,c2){
    document.documentElement.style.setProperty('--bg1', c1)
    document.documentElement.style.setProperty('--bg2', c2)
  }

  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)] }

  // Generatori
  function createLeaf(palette, shapes){
    const leaf = document.createElement('div'); leaf.className = 'leaf'
    const c1 = pick(palette), c2 = pick(palette)
    const shape = pick(shapes)
    const size = Math.random()*22 + 18
    const startX = Math.random()*100
    const driftPx = Math.floor(Math.random()*140 - 70)
    const dur = 6 + Math.random()*8
    const baseDeg = Math.floor(Math.random()*180)
    const spinDeg = Math.random()>0.5 ? 210 : -210

    leaf.style.setProperty('--x', startX+'vw')
    leaf.style.setProperty('--drift', driftPx+'px')
    leaf.style.setProperty('--r', baseDeg+'deg')
    leaf.style.setProperty('--rEnd', (baseDeg+spinDeg)+'deg')
    leaf.style.animationDuration = `${dur}s`

    const gid = 'g'+Math.random().toString(36).slice(2)
    const rot = document.createElement('div')
    rot.className = 'rot'; rot.style.animationDuration = `${dur*0.9}s`
    rot.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="${gid}" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="${c1}" /><stop offset="100%" stop-color="${c2}" /></linearGradient></defs><path d="${shape}" fill="url(#${gid})" /></svg>`
    leaf.appendChild(rot)
    leaf.addEventListener('animationend', ()=> leaf.remove())
    return leaf
  }

  function createTextParticle(chars, sizeMin=12, sizeMax=22, className='flakeTxt'){
    const el = document.createElement('div'); el.className = className
    el.textContent = pick(chars)
    const startX = Math.random()*100
    const driftPx = Math.floor(Math.random()*100 - 50)
    const dur = 7 + Math.random()*9
    el.style.setProperty('--x', startX+'vw')
    el.style.setProperty('--drift', driftPx+'px')
    el.style.animationDuration = dur+'s'
    el.style.fontSize = Math.floor(Math.random()*(sizeMax-sizeMin)+sizeMin)+'px'
    el.addEventListener('animationend', ()=> el.remove())
    return el
  }

  function createShardParticle(chars){
    return createTextParticle(chars, 10, 26, 'flakeTxt')
  }

  // Aggiorna tema ogni 5 minuti
  function updateTheme(){
    const now = new Date()
    const slot = Math.floor(now.getMinutes()/5) % 12
    if(slot === currentSlot) return
    currentSlot = slot

    const t = THEMES[slot]
    setBackground(t.bg[0], t.bg[1])

    // frase con fade
    lineEl.classList.add('fade')
    setTimeout(()=>{ lineEl.textContent = t.text; lineEl.classList.remove('fade') }, 260)

    // obiettivi particelle per slot
    targetLeaves = 36 + Math.floor(Math.random()*10) // leggera variazione
    targetFlakes = 0

    // pulisci le particelle precedenti per evitare residui quando cambi macro genere
    scene.querySelectorAll('.leaf,.flake,.flakeTxt').forEach(n=>n.remove())

    // memorizza tema corrente
    document.body.dataset.mode = t.mode
    document.body.dataset.shapes = t.shapes
    document.body.dataset.palette = t.palette.join(',')
  }

  function paletteFromDataset(){
    return (document.body.dataset.palette || '').split(',').filter(Boolean)
  }

  // Loop animazione
  function loop(){
    const shapesKey = document.body.dataset.shapes || 'leaves'
    const palette = paletteFromDataset()
    const leavesNow = scene.querySelectorAll('.leaf').length
    const flakesNow = scene.querySelectorAll('.flake,.flakeTxt').length

    // genera secondo tema
    if(shapesKey.startsWith('leaves')){
      if(leavesNow < targetLeaves){
        scene.appendChild(createLeaf(palette, LEAF_SHAPES))
      }
    }
    if(shapesKey === 'leavesHeavy'){
      if(leavesNow < targetLeaves+8){
        scene.appendChild(createLeaf(palette, LEAF_SHAPES))
      }
    }
    if(shapesKey === 'leavesLite'){
      if(leavesNow < Math.max(24, targetLeaves-8)){
        scene.appendChild(createLeaf(palette, LEAF_SHAPES))
      }
    }

    if(shapesKey === 'flakes'){
      if(flakesNow < 20) scene.appendChild(createTextParticle(EMOJI.flakes, 16, 24))
    }
    if(shapesKey === 'flakesSoft'){
      if(flakesNow < 26) scene.appendChild(createTextParticle(EMOJI.softFlakes, 14, 22))
    }
    if(shapesKey === 'crystals'){
      if(flakesNow < 18) scene.appendChild(createTextParticle(EMOJI.softFlakes, 14, 26))
    }
    if(shapesKey === 'stars'){
      if(flakesNow < 22) scene.appendChild(createTextParticle(EMOJI.stars, 14, 20))
    }
    if(shapesKey === 'needles'){
      if(flakesNow < 18) scene.appendChild(createTextParticle(EMOJI.needles, 12, 18))
    }
    if(shapesKey === 'berries'){
      if(flakesNow < 16) scene.appendChild(createTextParticle(EMOJI.berries, 10, 14))
    }
    if(shapesKey === 'acorns'){
      if(flakesNow < 14) scene.appendChild(createTextParticle(EMOJI.acorns, 12, 18))
    }
    if(shapesKey === 'shards'){
      if(flakesNow < 20) scene.appendChild(createShardParticle(EMOJI.shards))
    }

    requestAnimationFrame(loop)
  }

  // Avvio
  updateTheme()
  // seed visivo iniziale
  for(let i=0;i<28;i++) scene.appendChild(createLeaf(['#ffb703','#fb8500'], LEAF_SHAPES))
  loop()
  // controllo frequente per cogliere il passaggio di slot senza attese
  setInterval(updateTheme, 15000)

  // Waitlist semplice con Formspree
  const modal = document.getElementById('wlModal')
  document.getElementById('ctaOpen').onclick = () => modal.style.display='flex'
  document.getElementById('wlClose').onclick = () => modal.style.display='none'
  document.getElementById('wlBackdrop').onclick = () => modal.style.display='none'

  document.getElementById('waitlist').addEventListener('submit', async e=>{
    e.preventDefault()
    const email = document.getElementById('email').value.trim()
    const consent = document.getElementById('consent').checked
    if(!email || !consent){ alert('Inserisci email e consenso'); return }
    const data = new FormData()
    data.append('email', email)
    data.append('consent', consent ? 'yes' : 'no')
    try{
      const res = await fetch('https://formspree.io/f/xxxxxxx', { // sostituisci con il tuo endpoint
        method:'POST', headers:{'Accept':'application/json'}, body:data
      })
      if(!res.ok) throw new Error('server')
      alert('Iscrizione confermata'); e.target.reset(); modal.style.display='none'
    }catch(err){ alert('Errore invio. Riprova') }
  })
})
</script>
</body>
</html>
